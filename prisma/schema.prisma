// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- Enum: ì†Œë¹„ ìœ í˜•ì„ ìœ„í•œ ì—´ê±°í˜• ---
enum ConsumptionType {
  AMOUNT
  PERCENTAGE
}

// --- ë©”ì¸ í”„ë¡œí•„ ëª¨ë¸ ---
model FinancialProfile {
  id                         String    @id @default(cuid())
  createdAt                  DateTime  @default(now())
  updatedAt                  DateTime  @updatedAt
  
  // ì´ë¦„ê³¼ ê°€ì¡± ì •ë³´
  name                    String?
  familyMembers           Json?

  // ë¯¸ë˜ ê³„íš
  dob                        DateTime? // ìƒë…„ì›”ì¼
  retirementAge              Int?      // ì •ë…„
  peakWagePeriod             Int?      // ì„ê¸ˆí”¼í¬ ê¸°ê°„
  peakWageReductionRate      Float?    // ì„ê¸ˆí”¼í¬ ê°ì†Œìœ¨
  
  // ì›”ë³„ ê³ ì • ì§€ì¶œ
  consumptionType            ConsumptionType @default(AMOUNT) // ì†Œë¹„ ìœ í˜• (ê¸ˆì•¡ or ë¹„ìœ¨)
  monthlyConsumptionValue    Float?          // ì†Œë¹„ ê¸ˆì•¡ ë˜ëŠ” ë¹„ìœ¨ ê°’
  monthlyInsurance           Float?          // ì›”ë³„ ë³´í—˜ë£Œ
  monthlySavings             Float?          // ì›”ë³„ ì ê¸ˆ
  monthlyRepayment           Float?          // ì›”ë³„ ì›ë¦¬ê¸ˆ ìƒí™˜ì•¡
  
  summary                 Json?

  // ê´€ê³„ ì„¤ì •
  monthlyIncomes             MonthlyIncome[] // 1:N ê´€ê³„ (í•œ í”„ë¡œí•„ì— ì—¬ëŸ¬ ì›”ë³„ ìˆ˜ì…)
  loans                      Loan[]          // 1:N ê´€ê³„ (í•œ í”„ë¡œí•„ì— ì—¬ëŸ¬ ëŒ€ì¶œ)
  projectedData              ProjectedData[]

  realEstateAssets            RealEstateAsset[]
  salaryInflationRate       Float? 

  projectedLoanStates     ProjectedLoanState[]
}

// --- í”„ë¡œì ì…˜ ë°ì´í„° ëª¨ë¸ (ì›”ë³„ í˜„ê¸ˆ íë¦„ ë° ìì‚° ì¶”ì •ì¹˜) ---
model ProjectedData {
 id       String  @id @default(cuid())
 year      Int
 month     Int
 income     Float?
 bonus     Float?
 loanInterestPaid Float?
 loanPrincipalPaid Float?
 // totalLoanPayment Float?
 monthlyConsumption Float?
 cumulativeSavings Float?
 remainingLoanPrincipalTotal Float?
 disposableIncome Float?
 endOfYearAssets Float?
 isOverridden  Boolean @default(false)
 realEstateValue Float?
 totalAssets     Float? 

 // âœ¨ ê´€ê³„ ì„¤ì •
 profileId   String
 projectedLoanStates ProjectedLoanState[]
 financialProfile FinancialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade) 

 @@unique([profileId, year, month])
}

// --- ì›”ë³„ ìˆ˜ì… ëª¨ë¸ ---
model MonthlyIncome {
  id                  String   @id @default(cuid())
  month               Int      // ì›” (1 ~ 12)
  income              Float    // ìˆ˜ì…
  bonus               Float    // ë³´ë„ˆìŠ¤
  
  // ê´€ê³„ ì„¤ì •
  profileId           String
  financialProfile    FinancialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([profileId, month]) // í•œ í”„ë¡œí•„ì— ê°™ì€ ì›”ì´ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ì„¤ì •
}

// --- ëŒ€ì¶œ ì •ë³´ ëª¨ë¸ ---
model Loan {
  id                  String   @id @default(cuid())
  name         String?  // ëŒ€ì¶œ ì´ë¦„
  type         String?  // ëŒ€ì¶œ ì¢…ë¥˜
  principal           Float    // ëŒ€ì¶œ ì›ê¸ˆ
  interestRate        Float    // ì—°ì´ìœ¨
  termInYears     Int?   // ëŒ€ì¶œ ê¸°ê°„ (ì—° ë‹¨ìœ„)  
  gracePeriodInYears Int? // ê±°ì¹˜ê¸°ê°„ ì¶”ê°€
  paymentMethod String // ì˜ˆ: 'ì›ë¦¬ê¸ˆê· ë“±', 'ì›ê¸ˆê· ë“±', 'ë§Œê¸°ì¼ì‹œ'
  
  // ê´€ê³„ ì„¤ì •
  profileId           String
  financialProfile    FinancialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  projectedLoanStates ProjectedLoanState[]
}

// --- [ì¶”ê°€] ë¶€ë™ì‚° ìì‚° ëª¨ë¸ ---
model RealEstateAsset {
  id           String   @id @default(cuid())
  name         String   // ìì‚° ì´ë¦„ (ì˜ˆ: ì•„íŒŒíŠ¸, ì˜¤í”¼ìŠ¤í…”)
  currentValue Float    // í˜„ì¬ ê°€ì¹˜ (ë§Œì›)

  // ê´€ê³„ ì„¤ì •
  profileId    String
  financialProfile FinancialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

// ğŸ’¡ ìƒˆë¡œìš´ ëª¨ë¸: ì›”ë³„ ê°œë³„ ëŒ€ì¶œ ìƒíƒœ ì €ì¥
model ProjectedLoanState {
  id                    String   @id @default(cuid())
  year                  Int
  month                 Int

  // ğŸ’¡ ëŒ€ì¶œ ìƒíƒœ ì •ë³´
  principalPaid         Float?
  interestPaid          Float?
  remainingPrincipal    Float?
  
  // ğŸ’¡ ê´€ê³„ ì„¤ì •
  profileId             String
  loanId                String
  projectedDataId       String
  
  // ğŸ’¡ ì—°ê²°ëœ ëª¨ë¸
  financialProfile      FinancialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  loan                  Loan             @relation(fields: [loanId], references: [id])
  projectedData         ProjectedData    @relation(fields: [projectedDataId], references: [id])

  @@unique([projectedDataId, loanId])
}